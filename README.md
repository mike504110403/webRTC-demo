# WebRTC ç›´æ’­ç³»çµ±ï¼ˆP2SFU2Pï¼‰

> åŸºæ–¼ Pion WebRTC çš„ä½å»¶é²ç›´æ’­ç³»çµ±ï¼Œæ”¯æ´ 1 å°å¤šå³æ™‚ä¸²æµ

## âœ¨ åŠŸèƒ½ç‰¹é»

- âœ… **ä½å»¶é²ç›´æ’­**ï¼š< 1 ç§’å»¶é²
- âœ… **1 å°å¤šè½‰ç™¼**ï¼šå…§å»º Pion WebRTC SFU
- âœ… **Docker æ”¯æ´**ï¼šä¸€éµå•Ÿå‹•ï¼Œç„¡éœ€å®‰è£ç’°å¢ƒ
- âœ… **å±€åŸŸç¶²è¨ªå•**ï¼šæ”¯æ´å¤šè¨­å‚™åŒæ™‚è§€çœ‹

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ–¹å¼ 1ï¼šDockerï¼ˆæ¨è–¦ï¼‰â­

**ç„¡éœ€å®‰è£ Go å’Œ Node.js**

```bash
# ä¸€éµå•Ÿå‹•
./docker-start.sh

# åœæ­¢
./docker-stop.sh
```

é¦–æ¬¡å•Ÿå‹•éœ€è¦æ§‹å»ºé¡åƒï¼ˆ5-10 åˆ†é˜ï¼‰ï¼Œå¾ŒçºŒåªéœ€å¹¾ç§’ã€‚

ğŸ“– è©³ç´°èªªæ˜ï¼š[DOCKER.md](./DOCKER.md)

### æ–¹å¼ 2ï¼šæœ¬åœ°é–‹ç™¼

**éœ€è¦ Go 1.21+ å’Œ Node.js 18+**

```bash
# 1. å®‰è£ä¾è³´ï¼ˆé¦–æ¬¡ï¼‰
cd frontend && npm install && cd ..
cd backend && go mod download && cd ..

# 2. å•Ÿå‹•
./start.sh

# 3. åœæ­¢
./stop.sh
```

### è¨ªå•åœ°å€

```
ä¸»æ’­ç«¯: http://localhost:5173/broadcaster
è§€çœ¾ç«¯: http://localhost:5173/viewer
å¾Œç«¯API: http://localhost:8080/health
```

**å±€åŸŸç¶²è¨ªå•**ï¼š
- æŸ¥çœ‹æœ¬æ©Ÿ IPï¼š`ipconfig getifaddr en0`ï¼ˆmacOSï¼‰
- è¨ªå•ï¼š`http://<ä½ çš„IP>:5173/broadcaster`

## ğŸ¯ æŠ€è¡“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»æ’­ç«¯   â”‚         â”‚ Signalingâ”‚         â”‚  è§€çœ¾ç«¯   â”‚
â”‚          â”‚         â”‚  + SFU   â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚
     â”‚ 1. WebSocket é€£æ¥  â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚                    â”‚
     â”‚ 2. Offer SDP       â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚                    â”‚
     â”‚ 3. Answer SDP      â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                    â”‚
     â”‚ 4. ICE Candidates  â”‚                    â”‚
     â”‚<â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚                    â”‚
     â”‚                    â”‚                    â”‚
     â”‚ 5. DTLS æ¡æ‰‹       â”‚                    â”‚
     â”‚<â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚                    â”‚
     â”‚    âœ… é€£ç·šå»ºç«‹      â”‚                    â”‚
     â”‚                    â”‚                    â”‚
     â”‚ 6. æ¨é€ SRTP       â”‚                    â”‚
     â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚                    â”‚
     â”‚   (åŠ å¯†éŸ³è¦–è¨Š)      â”‚                    â”‚
     â”‚                    â”‚  7. WebSocket é€£æ¥ â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚
     â”‚                    â”‚  8. Offer SDP      â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚
     â”‚                    â”‚  9. Answer SDP     â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 10. ICE + DTLS     â”‚
     â”‚                    â”‚<â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚
     â”‚                    â”‚    âœ… é€£ç·šå»ºç«‹      â”‚
     â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 11. è½‰ç™¼ SRTP      â”‚
     â”‚                    â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•>â”‚
     â”‚                    â”‚   (åŠ å¯†éŸ³è¦–è¨Š)      â”‚ â–¶ï¸ æ’­æ”¾
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- **P2SFU2P**ï¼šä¸»æ’­ â†’ SFU â†’ å¤šå€‹è§€çœ¾
- **WebSocket**ï¼šSignalingï¼ˆäº¤æ› SDP/ICEï¼‰
- **DTLS**ï¼šå»ºç«‹åŠ å¯†é€šé“
- **SRTP**ï¼šåŠ å¯†éŸ³è¦–è¨Šå‚³è¼¸

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

```
webRTC-demo/
â”œâ”€â”€ backend/                 # Go å¾Œç«¯
â”‚   â”œâ”€â”€ main.go              # HTTP + WebSocket + SFU
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ internal/
â”‚       â”œâ”€â”€ signaling/       # WebSocket Signaling
â”‚       â””â”€â”€ sfu/             # Pion WebRTC SFU
â”‚
â”œâ”€â”€ frontend/                # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ services/        # WebSocket + WebRTC
â”‚   â”‚   â””â”€â”€ views/           # Broadcaster + Viewer
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ nginx.conf
â”‚
â”œâ”€â”€ docker-compose.yml       # Docker ç·¨æ’
â”œâ”€â”€ docker-start.sh          # Docker å•Ÿå‹•
â”œâ”€â”€ start.sh                 # æœ¬åœ°é–‹ç™¼å•Ÿå‹•
â””â”€â”€ README.md
```

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

| å±¤ç´š | æŠ€è¡“ |
|------|------|
| **å‰ç«¯** | Vue 3 + TypeScript |
| **å¾Œç«¯** | Go + Pion WebRTC |
| **é€šè¨Š** | WebSocketï¼ˆSignalingï¼‰ |
| **åª’é«”** | SRTPï¼ˆåŠ å¯†ä¸²æµï¼‰ |
| **éƒ¨ç½²** | Docker + Nginx |

## ğŸ® ä½¿ç”¨èªªæ˜

### ä¸»æ’­ç«¯

1. è¨ªå•ï¼š`http://localhost:5173/broadcaster`
2. é»æ“Šã€Œé–‹å§‹ç›´æ’­ã€
3. æˆæ¬Šæ”åƒé ­/éº¥å…‹é¢¨
4. âœ… é–‹å§‹æ¨æµ

### è§€çœ¾ç«¯

1. è¨ªå•ï¼š`http://localhost:5173/viewer`
2. é»æ“Šã€ŒåŠ å…¥ç›´æ’­ã€
3. âœ… è§€çœ‹ç›´æ’­

### æ¸¬è©¦å ´æ™¯

- **å–®æ©Ÿæ¸¬è©¦**ï¼šåŒä¸€é›»è…¦é–‹å…©å€‹åˆ†é 
- **å¤šè¨­å‚™æ¸¬è©¦**ï¼šé›»è…¦ä¸»æ’­ + æ‰‹æ©Ÿè§€çœ¾ï¼ˆåŒä¸€ WiFiï¼‰
- **å¤šäººè§€çœ‹**ï¼š1 ä¸»æ’­ + N è§€çœ¾

## ğŸ”§ é–‹ç™¼å‘½ä»¤

### Docker

```bash
# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f

# é‡å•Ÿ
docker-compose restart

# é‡æ–°æ§‹å»º
docker-compose build --no-cache

# æ¸…ç†
docker-compose down --rmi all
```

### æœ¬åœ°é–‹ç™¼

```bash
# å¾Œç«¯
cd backend && go run main.go

# å‰ç«¯
cd frontend && npm run dev
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### è§€çœ¾çœ‹ä¸åˆ°ç•«é¢

```bash
# 1. æŸ¥çœ‹æ—¥èªŒ
docker-compose logs backend

# 2. æª¢æŸ¥ Consoleï¼ˆF12ï¼‰

# 3. é‡å•Ÿæœå‹™
./docker-stop.sh && ./docker-start.sh
```

### ç«¯å£è¢«ä½”ç”¨

```bash
# æª¢æŸ¥
lsof -i :8080
lsof -i :5173

# æ®ºæ‰é€²ç¨‹
kill -9 <PID>
```

### å±€åŸŸç¶²ç„¡æ³•è¨ªå•

1. ç¢ºèªåŒä¸€ WiFi
2. æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®
3. ä½¿ç”¨ Chrome ç€è¦½å™¨

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

- **å»¶é²**ï¼š< 1 ç§’
- **æ”¯æ´è§€çœ¾æ•¸**ï¼šç†è«–ç„¡ä¸Šé™ï¼ˆSFU è½‰ç™¼ï¼‰
- **é¡åƒå¤§å°**ï¼šå¾Œç«¯ 50MBï¼Œå‰ç«¯ 30MB
- **åŠ å¯†**ï¼šDTLS 1.2

## ğŸš€ æœªä¾†æ“´å±•

- ğŸ”„ æ–·ç·šè‡ªå‹•é‡é€£
- ğŸ äº’å‹•åŠŸèƒ½ï¼ˆé€ç¦®ã€é»è´Šï¼‰
- ğŸ¤ é€£éº¥åŠŸèƒ½ï¼ˆå¤šä¸»æ’­ï¼‰
- ğŸ“Š æ€§èƒ½ç›£æ§é¢æ¿
- ğŸ” èº«ä»½é©—è­‰ï¼ˆJWTï¼‰
- ğŸ’¾ Redis æŒä¹…åŒ–

## ğŸ“š ç›¸é—œæ–‡æª”

- [DOCKER.md](./DOCKER.md) - Docker è©³ç´°æŒ‡å—
- [QUICKSTART.md](./QUICKSTART.md) - å¿«é€Ÿé–‹å§‹æŒ‡å—
- [CHANGELOG-DOCKER.md](./CHANGELOG-DOCKER.md) - Docker æ›´æ–°æ—¥èªŒ

## ğŸ¯ MVP é©—æ”¶æ¨™æº–

- âœ… ä¸»æ’­èƒ½æ¨æµ
- âœ… å¤šå€‹è§€çœ¾åŒæ™‚è§€çœ‹
- âœ… å»¶é² < 1 ç§’
- âœ… å±€åŸŸç¶²è¨ªå•
- âœ… Docker ä¸€éµéƒ¨ç½²

## ğŸ“ é–‹ç™¼èƒŒæ™¯

å¾ RTMP/HLS æ¶æ§‹è½‰å‘ WebRTCï¼Œå¯¦ç¾ä½å»¶é²äº’å‹•ç›´æ’­ã€‚

**æŠ€è¡“æ¼”é€²**ï¼š
```
RTMP â†’ HLS (5-10s å»¶é²)  â†’  WebRTC (< 1s å»¶é²)
```

**æ¶æ§‹é¸æ“‡**ï¼š
- **SFU** (Selective Forwarding Unit)ï¼šä¸è½‰ç¢¼ï¼Œåªè½‰ç™¼
- **P2SFU2P**ï¼šä¸»æ’­ â†’ SFU â†’ è§€çœ¾
- **å…§å»º SFU**ï¼šä½¿ç”¨ Pion WebRTCï¼Œç„¡éœ€å¤–éƒ¨æœå‹™

## ğŸŒŸ å°ˆæ¡ˆäº®é»

1. **å®Œæ•´å¯¦ç¾**ï¼šSignaling + SFU + å‰å¾Œç«¯
2. **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šæ˜“æ–¼æ“´å±•æ–°åŠŸèƒ½
3. **Docker æ”¯æ´**ï¼šä¸€éµéƒ¨ç½²
4. **æŠ€è¡“å®Œæ•´æ€§**ï¼šWebSocketã€WebRTCã€DTLSã€SRTP
5. **å¯¦ç”¨æ€§**ï¼šå¯ç›´æ¥ç”¨æ–¼é¢è©¦å±•ç¤º

---

**ç‰ˆæœ¬**ï¼šMVP v1.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-06  
**ç‹€æ…‹**ï¼šâœ… å¯é‹è¡Œã€å¯å±•ç¤ºã€å¯æ“´å±•
